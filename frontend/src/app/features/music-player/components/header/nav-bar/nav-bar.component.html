<!-- Hamburger Menu Navigation (for all screen sizes) -->
<div class="mobile-nav">
  <button class="hamburger-button" (click)="toggleMobileMenu()" [attr.aria-expanded]="isMobileMenuOpen()"
    aria-controls="mobile-menu" aria-label="Open menu">
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
  </button>

  @if (isMobileMenuOpen()) {
  <div class="mobile-menu-overlay" (click)="closeMobileMenu()">
    <div id="mobile-menu" class="mobile-menu" (click)="$event.stopPropagation()">
      <div class="mobile-menu-header">

        <!-- User Authentication Section -->
        @if (isUserLoggedIn()) {
        <div class="user-avatar">
          <img [src]="avatarSrc()" alt="User Avatar" class="avatar-image" />
          <span class="username">{{ displayUsername() }}</span>

          @if (isOAuthConnected()) {
          <div class="connected-indicator">
            <span class="connected-icon">‚úì</span>
            Connected
          </div>
          }
        </div>
        } @else {
        <div class="auth-section">
          <h3>Get Started</h3>
          <div class="auth-buttons">
            <button class="auth-btn login-btn" type="button" (click)="openManualLogin()">
              <span class="btn-icon">üìß</span>
              Login / Sign Up
            </button>

            <!-- Google OAuth (native POST) -->
            <form [attr.action]="environment.apiUrl + '/auth/google_oauth2'" method="post" target="_self"
              class="inline-form">
              <button type="submit" class="auth-btn oauth-btn" aria-label="Login with Google">
                <span class="btn-icon">üîë</span>
                Login with Google
              </button>
            </form>
          </div>
        </div>
        }

      </div>

      <!-- Platform Connection + Navigation (only show if logged in) -->
      @if (isUserLoggedIn()) {
      <div class="platform-section">
        <h4>Connect Platforms</h4>
        <div class="divider"></div>
        <div class="platform-buttons">
          <!-- YouTube connect/disconnect -->
          @if (!isPlatformConnected('youtube')) {
          <form [attr.action]="environment.apiUrl + '/auth/youtube'" method="post" target="_self" class="inline-form">
            <button type="submit" class="platform-btn youtube-btn" aria-label="Connect YouTube">
              <span class="platform-icon">üì∫</span>
              YouTube (Click to connect)
            </button>
          </form>
          } @else {
          <button class="platform-btn youtube-btn connected" type="button" (click)="disconnectPlatform('youtube')"
            aria-label="Disconnect YouTube">
            <span class="platform-icon">üì∫</span>
            YouTube ‚úì (Click to disconnect)
          </button>
          }

          <!-- Spotify connect/disconnect -->
          @if (!isPlatformConnected('spotify')) {
          <form action="http://127.0.0.1:3000/auth/spotify" method="post" target="_self" class="inline-form">
            <button type="submit" class="platform-btn spotify-btn" aria-label="Connect Spotify">
              <span class="platform-icon">üéµ</span>
              Connect Spotify
            </button>
          </form>
          } @else {
          <button class="platform-btn spotify-btn connected" type="button" (click)="disconnectPlatform('spotify')"
            aria-label="Disconnect Spotify">
            <span class="platform-icon">üéµ</span>
            Spotify ‚úì (Click to disconnect)
          </button>
          }
        </div>

        <!-- Player Tabs (only when on /platform/*) -->
        
        <div class="divider"></div>
        <!-- Platform Navigation Buttons -->
        <!-- Platform Navigation (only if logged in & YouTube connected) -->
        @if (isUserLoggedIn() && isPlatformConnected('youtube')) {
        <div class="platform-switch">
          <button class="glass-platform-btn youtube" (click)="navigatePlatform('youtube')">
            <span class="icon">üì∫</span>
            Open YouTube Player
          </button>
        </div>
        }
        @if (isOAuthConnected('spotify')) {
        <button class="glass-platform-btn spotify" (click)="navigatePlatform('spotify')">
          üéµ Spotify
        </button>
        }
        @if (isOAuthConnected('spotify') || isOAuthConnected('youtube')) {
        <button class="glass-platform-btn omniplay" (click)="navigatePlatform('omniplay')">
          ‚òÅÔ∏è OmniPlay
        </button>
        }

        <!-- Logout -->
        <div class="logout-section">
          <button class="logout-btn" type="button" (click)="logout()">Logout</button>
        </div>
      </div>
      }
    </div>
  </div>
  }
</div>