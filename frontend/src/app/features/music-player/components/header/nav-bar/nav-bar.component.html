<!-- Hamburger Menu Navigation (for all screen sizes) -->
<div class="mobile-nav">
  <button class="hamburger-button" (click)="toggleMobileMenu()" [attr.aria-expanded]="isMobileMenuOpen()"
    aria-controls="mobile-menu" aria-label="Open menu">
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
  </button>

  @if (isMobileMenuOpen()) {
  <div class="mobile-menu-overlay" (click)="closeMobileMenu()">
    <div id="mobile-menu" class="mobile-menu" (click)="$event.stopPropagation()">
      <div class="mobile-menu-header">

        <!-- User Authentication Section -->
        @if (isUserLoggedIn()) {
        <div class="user-avatar">
          <img [src]="avatarSrc()" alt="User Avatar" class="avatar-image" />
          <span class="username">{{ displayUsername() }}</span>

          @if (isOAuthConnected()) {
          <div class="connected-indicator">
            <span class="connected-icon">✓</span>
            Connected
          </div>
          }
        </div>
        } @else {
        <div class="auth-section">
          <h3>Get Started</h3>
          <div class="auth-buttons">
            <button class="auth-btn login-btn" type="button" (click)="openManualLogin()">
              
              Login / Sign Up
            </button>

            <!-- Google OAuth (native POST) -->
            <form [attr.action]="environment.apiUrl + '/auth/google_oauth2'" method="post" target="_self" class="inline-form">
              <button type="submit" class="auth-btn oauth-btn google-image-btn" aria-label="Login with Google">
                <img src="assets/images/web_dark_sq_SU@4x.png" alt="Sign in with Google" class="google-login-img" />
              </button>
            </form>
          </div>
        </div>
        }

      </div>

      <!-- Platform Connection + Navigation (only show if logged in) -->
      @if (isUserLoggedIn()) {
      <div class="platform-section">
        <h4>Connect Platforms</h4>
        <div class="divider"></div>
        <div class="platform-buttons">
          <!-- YouTube connect/disconnect -->
          @if (!isPlatformConnected('youtube')) {
          <form [attr.action]="environment.apiUrl + '/auth/youtube'" method="post" target="_self" class="inline-form">
            <button type="submit" class="platform-btn youtube-btn" aria-label="Connect YouTube">
              <img src="assets/images/yt_icon_red_digital.png" alt="YouTube" class="yt-small-icon" />
              Connect YouTube
            </button>
          </form>
          } @else {
          <button class="platform-btn youtube-btn connected" type="button" (click)="disconnectPlatform('youtube')"
            aria-label="Disconnect YouTube">
            <img src="assets/images/yt_icon_red_digital.png" alt="YouTube" class="yt-small-icon" />
            YouTube ✓ (Click to disconnect)
          </button>
          }

          <!-- Spotify connect/disconnect -->
          @if (!isPlatformConnected('spotify')) {
          <form [attr.action]="environment.apiUrl + '/auth/spotify'" method="post" target="_self" class="inline-form">
            <button type="submit" class="platform-btn spotify-btn" aria-label="Connect Spotify">
              <img src="assets/images/Spotify_Primary_Logo_RGB_Green.png" alt="Spotify" class="spotify-small-icon" />
              Connect Spotify
            </button>
          </form>
          } @else {
          <button class="platform-btn spotify-btn connected" type="button" (click)="disconnectPlatform('spotify')"
            aria-label="Disconnect Spotify">
            <img src="assets/images/Spotify_Primary_Logo_RGB_Green.png" alt="Spotify" class="spotify-small-icon" />
            Spotify ✓ (Click to disconnect)
          </button>
          }
        </div>

        <!-- Player Tabs (only when on /platform/*) -->
        
        <div class="divider"></div>
        <!-- Platform Navigation Buttons -->
        <!-- Platform Navigation (only if logged in & YouTube connected) -->
        @if (isUserLoggedIn() && isPlatformConnected('youtube')) {
        <div class="platform-switch">
          <button class="glass-platform-btn youtube" (click)="navigatePlatform('youtube')" aria-label="Open YouTube Player">
            <img src="assets/images/yt_logo_almostblack_digital.png" alt="YouTube" class="youtube-full-logo" />
          </button>
        </div>
        }
        @if (isOAuthConnected('spotify')) {
        <button class="glass-platform-btn spotify" (click)="navigatePlatform('spotify')" aria-label="Open Spotify Player">
          <img src="assets/images/Spotify_Full_Logo_RGB_Black.png" alt="Spotify" class="spotify-full-logo" />
        </button>
        }
        @if (isOAuthConnected('spotify') || isOAuthConnected('youtube')) {
        <button class="glass-platform-btn omniplay" (click)="navigatePlatform('omniplay')" aria-label="Open OmniPlay">
          <img src="assets/images/logo1.png" alt="OmniPlay" class="omniplay-logo" />
          OmniPlay
        </button>
        }

        <!-- Back to Landing (visible when logged in and on /platform/*) -->
        @if (isUserLoggedIn() && isOnPlatformRoute()) {
        <div class="divider"></div>
        <button class="glass-platform-btn back-home-btn" (click)="navigateLanding()" aria-label="Back to Landing">
          <span class="start-icon-wrap" aria-hidden="true">
            <img src="assets/images/music.gif" alt="" class="start-icon start-gif" draggable="false" />
          </span>
          <span class="start-text">Back to Home</span>
        </button>
        }

        <!-- Logout -->
        <div class="logout-section">
          <button class="logout-btn" type="button" (click)="logout()">
            <img src="assets/images/power.png" alt="" aria-hidden="true" class="logout-icon" />
            Logout
          </button>
        </div>
      </div>
      }
    </div>
  </div>
  }
</div>
